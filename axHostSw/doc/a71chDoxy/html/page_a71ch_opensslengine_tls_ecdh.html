<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>A71CH Host Sw: OpenSSL Engine: TLS 1.2 ECDH detailed transactions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">A71CH Host Sw
   &#160;<span id="projectnumber">v01.05.00</span>
   </div>
   <div id="projectbrief">NXP Semiconductors</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('page_a71ch_opensslengine_tls_ecdh.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">OpenSSL Engine: TLS 1.2 ECDH detailed transactions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li>DocRevision : 0.91</li>
<li>Date : 2017-06-12</li>
</ul>
<p>This section illustrates step-by-step the different messages exchanged between client and server to setup a TLS 1.2 connection (ECDH-ECDSA-AES128-SHA). Furthermore it illustrates the support offered by the Secure Element to the client.</p>
<h1><a class="anchor" id="autotoc_md23"></a>
(1) Summary</h1>
<p>The TLS 1.2 protocol is specified in (<a href="https://tools.ietf.org/html/rfc5246">https://tools.ietf.org/html/rfc5246</a>). The TLS demo demonstrates setting up a mutually authenticated and encrypted link between a client and a server system. The keypair used to identify the client is stored in the Secure Element. The keypair used to identify the server is simply available as a pem file.</p>
<p>The public keys associated with the respective key pairs are contained in respectively a client and a server certificate.</p>
<p>The signing (CA) keypair and associated certificate is a self-signed certificate. The same CA is used to sign client and server certificate.</p>
<p>The standard OpenSSL tools s_server and s_client are used to set-up and demonstrate the TLS link. Refer to <a class="el" href="page_a71ch_opensslengine_tls.html">OpenSSL Engine: TLS example</a> for the instructions that were used to set up the link.</p>
<p>Server Side </p><pre class="fragment">&gt; ./tlsServer.sh both
</pre><p>Client Side </p><pre class="fragment">&gt; ./tlsSeClient.sh &lt;IP-address&gt; ECDH
</pre><h1><a class="anchor" id="autotoc_md24"></a>
(2) Handshake protocol</h1>
<h2><a class="anchor" id="autotoc_md25"></a>
(2.1) Client Hello (Client-&gt;Server)</h2>
<dl class="section note"><dt>Note</dt><dd>The Secure Element is invoked to provide the random data that is part of the ClientHello</dd></dl>
<pre class="fragment">e2a71ch-flw: Version: 1.0.0
e2a71ch-flw: EmbSe_Rand invoked requesting 16 random bytes
e2a71ch-flw: EmbSe_Rand invoked requesting 16 random bytes
e2a71ch-flw: EmbSe_Rand invoked requesting 16 random bytes
CONNECTED(00000004)
SSL_connect:before/connect initialization
e2a71ch-flw: EmbSe_Rand invoked requesting 32 random bytes
&gt;&gt;&gt; ??? [length 0005]
    16 03 01 00 87
&gt;&gt;&gt; TLS 1.2 Handshake [length 0087], ClientHello
    01 00 00 83 03 03 f3 bb 46 ee eb c1 21 9a 84 b2
    d4 98 25 f3 0d b3 06 6c b5 16 72 69 89 26 e5 55
    82 ba d5 f4 fd 13 00 00 04 c0 04 00 ff 02 01 00
    00 55 00 0b 00 04 03 00 01 02 00 0a 00 1c 00 1a
    00 17 00 19 00 1c 00 1b 00 18 00 1a 00 16 00 0e
    00 0d 00 0b 00 0c 00 09 00 0a 00 23 00 00 00 0d
    00 20 00 1e 06 01 06 02 06 03 05 01 05 02 05 03
    04 01 04 02 04 03 03 01 03 02 03 03 02 01 02 02
    02 03 00 0f 00 01 01
SSL_connect:SSLv3 write client hello A
</pre><h2><a class="anchor" id="autotoc_md26"></a>
(2.2) Server Hello (Server-&gt;Client)</h2>
<pre class="fragment">&lt;&lt;&lt; ??? [length 0005]
    16 03 03 00 42
&lt;&lt;&lt; TLS 1.2 Handshake [length 0042], ServerHello
    02 00 00 3e 03 03 bb ab 25 5a d2 7c 00 96 1f 1a
    da 76 51 b2 11 3f 6a 3f e7 b2 1a 3a 77 c0 10 dd
    35 c6 df 31 68 26 00 c0 04 01 00 16 ff 01 00 01
    00 00 0b 00 04 03 00 01 02 00 23 00 00 00 0f 00
    01 01
SSL_connect:SSLv3 read server hello A
</pre><h2><a class="anchor" id="autotoc_md27"></a>
(2.3) Certificate (Server-&gt;Client)</h2>
<pre class="fragment">&lt;&lt;&lt; ??? [length 0005]
    16 03 03 04 3a
&lt;&lt;&lt; TLS 1.2 Handshake [length 043a], Certificate
    0b 00 04 36 00 04 33 00 01 c8 30 82 01 c4 30 82
    01 6b 02 09 00 c5 48 40 da 8d f6 2f 9d 30 0a 06
    08 2a 86 48 ce 3d 04 03 02 30 81 8c 31 0b 30 09
    06 03 55 04 06 13 02 42 45 31 16 30 14 06 03 55
    04 08 0c 0d 56 6c 61 61 6d 73 42 72 61 62 61 6e
    74 31 0f 30 0d 06 03 55 04 07 0c 06 4c 65 75 76
    65 6e 31 14 30 12 06 03 55 04 0a 0c 0b 4e 58 50
    2d 44 65 6d 6f 2d 43 41 31 12 30 10 06 03 55 04
    0b 0c 09 44 65 6d 6f 2d 55 6e 69 74 31 0f 30 0d
    06 03 55 04 03 0c 06 64 65 6d 6f 43 41 31 19 30
    17 06 09 2a 86 48 86 f7 0d 01 09 01 16 0a 64 65
    6d 6f 43 41 40 6e 78 70 30 1e 17 0d 31 37 30 36
    30 38 31 32 35 30 32 33 5a 17 0d 32 35 30 32 30
    36 31 32 35 30 32 33 5a 30 48 31 0b 30 09 06 03
    55 04 06 13 02 42 45 31 10 30 0e 06 03 55 04 0a
    0c 07 4e 58 50 44 65 6d 6f 31 0d 30 0b 06 03 55
    04 0b 0c 04 55 6e 69 74 31 18 30 16 06 03 55 04
    03 0c 0f 45 43 43 2d 64 65 6d 6f 2d 73 65 72 76
    65 72 30 59 30 13 06 07 2a 86 48 ce 3d 02 01 06
    08 2a 86 48 ce 3d 03 01 07 03 42 00 04 96 a5 2b
    e9 88 58 08 cb fb b9 ce 37 25 05 77 1b 6a 0d a7
    6e 0f b3 38 ba 34 6e 6d d4 71 6c 77 81 69 94 29
    04 46 5b 91 51 d9 56 ff 45 e5 5c b2 16 93 e5 a3
    e7 37 96 cd 00 f5 8b e2 1d 26 48 a3 38 30 0a 06
    08 2a 86 48 ce 3d 04 03 02 03 47 00 30 44 02 20
    65 39 bb 4d d8 e6 d5 68 5e 37 a0 59 43 48 1f 7a
    53 64 fd 7f 82 e6 fd a4 65 18 bd a1 a0 6b cd 5e
    02 20 55 6c 29 ed d1 bb 2a 8f 8c e0 6e f4 05 3d
    85 04 30 e4 63 3a 53 1c 59 bc c8 7e 1e 64 9a ce
    43 ab 00 02 65 30 82 02 61 30 82 02 07 a0 03 02
    01 02 02 09 00 d3 cd 65 95 02 f9 1a 12 30 0a 06
    08 2a 86 48 ce 3d 04 03 02 30 81 8c 31 0b 30 09
    06 03 55 04 06 13 02 42 45 31 16 30 14 06 03 55
    04 08 0c 0d 56 6c 61 61 6d 73 42 72 61 62 61 6e
    74 31 0f 30 0d 06 03 55 04 07 0c 06 4c 65 75 76
    65 6e 31 14 30 12 06 03 55 04 0a 0c 0b 4e 58 50
    2d 44 65 6d 6f 2d 43 41 31 12 30 10 06 03 55 04
    0b 0c 09 44 65 6d 6f 2d 55 6e 69 74 31 0f 30 0d
    06 03 55 04 03 0c 06 64 65 6d 6f 43 41 31 19 30
    17 06 09 2a 86 48 86 f7 0d 01 09 01 16 0a 64 65
    6d 6f 43 41 40 6e 78 70 30 1e 17 0d 31 37 30 36
    30 38 31 32 34 32 30 32 5a 17 0d 32 35 30 32 30
    36 31 32 34 32 30 32 5a 30 81 8c 31 0b 30 09 06
    03 55 04 06 13 02 42 45 31 16 30 14 06 03 55 04
    08 0c 0d 56 6c 61 61 6d 73 42 72 61 62 61 6e 74
    31 0f 30 0d 06 03 55 04 07 0c 06 4c 65 75 76 65
    6e 31 14 30 12 06 03 55 04 0a 0c 0b 4e 58 50 2d
    44 65 6d 6f 2d 43 41 31 12 30 10 06 03 55 04 0b
    0c 09 44 65 6d 6f 2d 55 6e 69 74 31 0f 30 0d 06
    03 55 04 03 0c 06 64 65 6d 6f 43 41 31 19 30 17
    06 09 2a 86 48 86 f7 0d 01 09 01 16 0a 64 65 6d
    6f 43 41 40 6e 78 70 30 59 30 13 06 07 2a 86 48
    ce 3d 02 01 06 08 2a 86 48 ce 3d 03 01 07 03 42
    00 04 74 92 31 99 08 6a 2b d5 81 12 79 c5 5d 43
    6c 23 a4 82 94 86 c3 f8 0a e0 b4 66 cd dc c0 66
    be c6 cb 4c a0 79 e5 e9 ed 12 b8 dc 4c 72 5b ab
    c1 fb 60 b3 4d 19 ed bb c7 69 cf 65 98 96 ab ae
    c6 0d a3 50 30 4e 30 1d 06 03 55 1d 0e 04 16 04
    14 3b 82 a8 ad 12 e0 70 97 e0 4f b6 2a 5c ad 35
    9e 62 25 91 30 30 1f 06 03 55 1d 23 04 18 30 16
    80 14 3b 82 a8 ad 12 e0 70 97 e0 4f b6 2a 5c ad
    35 9e 62 25 91 30 30 0c 06 03 55 1d 13 04 05 30
    03 01 01 ff 30 0a 06 08 2a 86 48 ce 3d 04 03 02
    03 48 00 30 45 02 20 5e fb f7 03 12 f8 10 7a 18
    fd 33 c6 19 c4 e9 74 e9 00 1b c7 89 78 74 9b 7b
    f2 c8 21 25 00 7b 3b 02 21 00 bb 4a de ab cc 8d
    15 ac 63 c3 7e 64 75 60 81 55 12 41 19 22 b0 7d
    04 4f 0e 7d 15 d5 00 c2 9e c8

depth=1 C = BE, ST = VlaamsBrabant, L = Leuven, O = NXP-Demo-CA, OU = Demo-Unit, CN = demoCA, emailAddress = demoCA@nxp
verify return:1
e2a71ch-flw: Invoking EmbSe_ECDSA_Do_Verify(..)
e2a71ch-dbg: ====&gt;SIGNATURE (len=70)
e2a71ch-dbg:
30 44 02 20 65 39 BB 4D D8 E6 D5 68 5E 37 A0 59
43 48 1F 7A 53 64 FD 7F 82 E6 FD A4 65 18 BD A1
A0 6B CD 5E 02 20 55 6C 29 ED D1 BB 2A 8F 8C E0
6E F4 05 3D 85 04 30 E4 63 3A 53 1C 59 BC C8 7E
1E 64 9A CE 43 AB
e2a71ch-dbg: ====&gt;DIGEST
6E FD AA 47 4E 8F CD 6A 8B 7E 36 5E B8 EF 1D 00
26 5F 1B B6 DE 63 C6 03 A4 F2 88 41 30 8D 31 0B
e2a71ch-dbg: A71_GetEccPublicKey(0x00)
e2a71ch-dbg: A71_GetEccPublicKey(0x01)
e2a71ch-flw: No matching key in A71CH. Invoking OpenSSL API: ECDSA_do_verify.
e2a71ch-flw: Verification by OpenSSL PASS
depth=0 C = BE, O = NXPDemo, OU = Unit, CN = ECC-demo-server
verify return:1
SSL_connect:SSLv3 read server certificate A
</pre><dl class="section note"><dt>Note</dt><dd>The OpenSSL engine is in the loop of the certificate verification. As the Secure Element was not provisioned with the CA public key, the verification is handed over to OpenSSL SW implementation.</dd></dl>
<h2><a class="anchor" id="autotoc_md28"></a>
(2.4) CertificateRequest (Server-&gt;Client)</h2>
<pre class="fragment">&lt;&lt;&lt; ??? [length 0005]
    16 03 03 00 c1
&lt;&lt;&lt; TLS 1.2 Handshake [length 00bd], CertificateRequest
    0d 00 00 b9 05 01 02 41 42 40 00 1e 06 01 06 02
    06 03 05 01 05 02 05 03 04 01 04 02 04 03 03 01
    03 02 03 03 02 01 02 02 02 03 00 91 00 8f 30 81
    8c 31 0b 30 09 06 03 55 04 06 13 02 42 45 31 16
    30 14 06 03 55 04 08 0c 0d 56 6c 61 61 6d 73 42
    72 61 62 61 6e 74 31 0f 30 0d 06 03 55 04 07 0c
    06 4c 65 75 76 65 6e 31 14 30 12 06 03 55 04 0a
    0c 0b 4e 58 50 2d 44 65 6d 6f 2d 43 41 31 12 30
    10 06 03 55 04 0b 0c 09 44 65 6d 6f 2d 55 6e 69
    74 31 0f 30 0d 06 03 55 04 03 0c 06 64 65 6d 6f
    43 41 31 19 30 17 06 09 2a 86 48 86 f7 0d 01 09
    01 16 0a 64 65 6d 6f 43 41 40 6e 78 70
SSL_connect:SSLv3 read server certificate request A
</pre><h2><a class="anchor" id="autotoc_md29"></a>
(2.5) ServerHelloDone (Server-&gt;Client)</h2>
<pre class="fragment">&lt;&lt;&lt; TLS 1.2 Handshake [length 0004], ServerHelloDone
    0e 00 00 00
SSL_connect:SSLv3 read server done A
</pre><h2><a class="anchor" id="autotoc_md30"></a>
(2.6) Certificate (Client-&gt;Server)</h2>
<dl class="section note"><dt>Note</dt><dd>The OpenSSL engine is in the loop of the verification of the signature on (it's own) Client Certificate. As the Secure Element was not provisioned with the relevant public key, the verification is handed over to OpenSSL SW implementation.</dd></dl>
<pre class="fragment">e2a71ch-flw: Invoking EmbSe_ECDSA_Do_Verify(..)
e2a71ch-dbg: ====&gt;SIGNATURE (len=72)
e2a71ch-dbg:
30 46 02 21 00 AA 7A 86 E5 F6 C6 B5 FF 92 16 F6
DD EA D1 E7 63 C8 09 BB 45 DD 86 B9 AD 67 E9 FB
62 1A 04 06 CE 02 21 00 E4 27 E2 FB 47 49 DA AC
09 B9 01 5A C4 0B 4B 68 98 29 67 9B 24 1E 76 15
88 55 18 51 82 CC FF 8A
e2a71ch-dbg: ====&gt;DIGEST
42 E1 F8 EB BF 99 13 2F 68 46 3C 2E 2B D3 9F 1F
2F 66 DA CA 3F F2 B9 CD A2 40 BB 22 03 DC 6C B8
e2a71ch-dbg: A71_GetEccPublicKey(0x00)
e2a71ch-dbg: A71_GetEccPublicKey(0x01)
e2a71ch-flw: No matching key in A71CH. Invoking OpenSSL API: ECDSA_do_verify.
e2a71ch-flw: Verification by OpenSSL PASS

&gt;&gt;&gt; ??? [length 0005]
    16 03 03 04 3c
&gt;&gt;&gt; TLS 1.2 Handshake [length 043c], Certificate
    0b 00 04 38 00 04 35 00 01 ca 30 82 01 c6 30 82
    01 6b 02 09 00 c5 48 40 da 8d f6 2f 9c 30 0a 06
    08 2a 86 48 ce 3d 04 03 02 30 81 8c 31 0b 30 09
    06 03 55 04 06 13 02 42 45 31 16 30 14 06 03 55
    04 08 0c 0d 56 6c 61 61 6d 73 42 72 61 62 61 6e
    74 31 0f 30 0d 06 03 55 04 07 0c 06 4c 65 75 76
    65 6e 31 14 30 12 06 03 55 04 0a 0c 0b 4e 58 50
    2d 44 65 6d 6f 2d 43 41 31 12 30 10 06 03 55 04
    0b 0c 09 44 65 6d 6f 2d 55 6e 69 74 31 0f 30 0d
    06 03 55 04 03 0c 06 64 65 6d 6f 43 41 31 19 30
    17 06 09 2a 86 48 86 f7 0d 01 09 01 16 0a 64 65
    6d 6f 43 41 40 6e 78 70 30 1e 17 0d 31 37 30 36
    30 38 31 32 35 30 32 32 5a 17 0d 32 35 30 32 30
    36 31 32 35 30 32 32 5a 30 48 31 0b 30 09 06 03
    55 04 06 13 02 42 45 31 10 30 0e 06 03 55 04 0a
    0c 07 4e 58 50 44 65 6d 6f 31 0d 30 0b 06 03 55
    04 0b 0c 04 55 6e 69 74 31 18 30 16 06 03 55 04
    03 0c 0f 45 43 43 2d 64 65 6d 6f 2d 63 6c 69 65
    6e 74 30 59 30 13 06 07 2a 86 48 ce 3d 02 01 06
    08 2a 86 48 ce 3d 03 01 07 03 42 00 04 1d 84 0b
    b0 25 b4 70 80 28 5e b9 90 95 9f eb d8 61 b1 13
    83 90 a9 93 2c cb 31 5c 7a 21 82 ca cc 24 84 db
    3c c2 d6 05 38 58 78 3e 85 e5 bf d1 36 5e 06 1f
    31 d2 86 e5 d0 e5 05 f6 94 9f 70 88 03 30 0a 06
    08 2a 86 48 ce 3d 04 03 02 03 49 00 30 46 02 21
    00 aa 7a 86 e5 f6 c6 b5 ff 92 16 f6 dd ea d1 e7
    63 c8 09 bb 45 dd 86 b9 ad 67 e9 fb 62 1a 04 06
    ce 02 21 00 e4 27 e2 fb 47 49 da ac 09 b9 01 5a
    c4 0b 4b 68 98 29 67 9b 24 1e 76 15 88 55 18 51
    82 cc ff 8a 00 02 65 30 82 02 61 30 82 02 07 a0
    03 02 01 02 02 09 00 d3 cd 65 95 02 f9 1a 12 30
    0a 06 08 2a 86 48 ce 3d 04 03 02 30 81 8c 31 0b
    30 09 06 03 55 04 06 13 02 42 45 31 16 30 14 06
    03 55 04 08 0c 0d 56 6c 61 61 6d 73 42 72 61 62
    61 6e 74 31 0f 30 0d 06 03 55 04 07 0c 06 4c 65
    75 76 65 6e 31 14 30 12 06 03 55 04 0a 0c 0b 4e
    58 50 2d 44 65 6d 6f 2d 43 41 31 12 30 10 06 03
    55 04 0b 0c 09 44 65 6d 6f 2d 55 6e 69 74 31 0f
    30 0d 06 03 55 04 03 0c 06 64 65 6d 6f 43 41 31
    19 30 17 06 09 2a 86 48 86 f7 0d 01 09 01 16 0a
    64 65 6d 6f 43 41 40 6e 78 70 30 1e 17 0d 31 37
    30 36 30 38 31 32 34 32 30 32 5a 17 0d 32 35 30
    32 30 36 31 32 34 32 30 32 5a 30 81 8c 31 0b 30
    09 06 03 55 04 06 13 02 42 45 31 16 30 14 06 03
    55 04 08 0c 0d 56 6c 61 61 6d 73 42 72 61 62 61
    6e 74 31 0f 30 0d 06 03 55 04 07 0c 06 4c 65 75
    76 65 6e 31 14 30 12 06 03 55 04 0a 0c 0b 4e 58
    50 2d 44 65 6d 6f 2d 43 41 31 12 30 10 06 03 55
    04 0b 0c 09 44 65 6d 6f 2d 55 6e 69 74 31 0f 30
    0d 06 03 55 04 03 0c 06 64 65 6d 6f 43 41 31 19
    30 17 06 09 2a 86 48 86 f7 0d 01 09 01 16 0a 64
    65 6d 6f 43 41 40 6e 78 70 30 59 30 13 06 07 2a
    86 48 ce 3d 02 01 06 08 2a 86 48 ce 3d 03 01 07
    03 42 00 04 74 92 31 99 08 6a 2b d5 81 12 79 c5
    5d 43 6c 23 a4 82 94 86 c3 f8 0a e0 b4 66 cd dc
    c0 66 be c6 cb 4c a0 79 e5 e9 ed 12 b8 dc 4c 72
    5b ab c1 fb 60 b3 4d 19 ed bb c7 69 cf 65 98 96
    ab ae c6 0d a3 50 30 4e 30 1d 06 03 55 1d 0e 04
    16 04 14 3b 82 a8 ad 12 e0 70 97 e0 4f b6 2a 5c
    ad 35 9e 62 25 91 30 30 1f 06 03 55 1d 23 04 18
    30 16 80 14 3b 82 a8 ad 12 e0 70 97 e0 4f b6 2a
    5c ad 35 9e 62 25 91 30 30 0c 06 03 55 1d 13 04
    05 30 03 01 01 ff 30 0a 06 08 2a 86 48 ce 3d 04
    03 02 03 48 00 30 45 02 20 5e fb f7 03 12 f8 10
    7a 18 fd 33 c6 19 c4 e9 74 e9 00 1b c7 89 78 74
    9b 7b f2 c8 21 25 00 7b 3b 02 21 00 bb 4a de ab
    cc 8d 15 ac 63 c3 7e 64 75 60 81 55 12 41 19 22
    b0 7d 04 4f 0e 7d 15 d5 00 c2 9e c8
SSL_connect:SSLv3 write client certificate A
</pre><h2><a class="anchor" id="autotoc_md31"></a>
(2.7) ClientKeyExchange (Client-&gt;Server)</h2>
<dl class="section note"><dt>Note</dt><dd>The Secure Element is used to provide the random data from which the ephemeral key is derived. The actual ECDH calculation is handled by the Open SSL SW implementation as the ephemeral key is not present inside the Secure Element. Also in case of ECDH-ECDSA an ephemeral key is created on the client side, ECDH-ECDSA simply implies that the Server Key Pair is embedded in the Server certificate. (<a href="https://tools.ietf.org/html/rfc4492#section-2.1">https://tools.ietf.org/html/rfc4492#section-2.1</a>)</dd></dl>
<pre class="fragment">e2a71ch-flw: EmbSe_Rand invoked requesting 32 random bytes
e2a71ch-flw: EmbSe_Compute_Key invoked (ecdh)
e2a71ch-flw: No matching key in A71CH. Invoking OpenSSL API: ECDH_compute_key.
e2a71ch-flw: ECDH_compute_key by OpenSSL PASS
e2a71ch-dbg: Shared Secret:
BD 13 AC 37 B7 32 63 4F 18 7F C5 77 01 0D 69 7E
7C 3D F3 EC 22 B3 25 4C CB DA 92 0E C6 99 F3 E4
&gt;&gt;&gt; ??? [length 0005]
    16 03 03 00 46
&gt;&gt;&gt; TLS 1.2 Handshake [length 0046], ClientKeyExchange
    10 00 00 42 41 04 2e 7e 6b 1d 6d f6 7a c8 e4 d3
    05 1e ab 0b ec 70 e8 2e c3 6d 7d 11 d0 e0 2c 24
    40 dc 7e 77 9a 01 69 17 c2 dd 4c 33 72 d3 26 f6
    7f 01 fe b9 fc f1 e0 e1 f1 d2 6a 6b c4 7b 9d 03
    75 c8 f7 fc b0 97
SSL_connect:SSLv3 write client key exchange A
</pre><h2><a class="anchor" id="autotoc_md32"></a>
(2.8) CertificateVerify (Client-&gt;Server)</h2>
<p>In this step the client signs a concatenation of handshake structures exchanged so far between client and server.</p>
<dl class="section note"><dt>Note</dt><dd>The Secure Element is used to sign the concatenated handshake structures. The identity proof depends on the Secure Element.</dd></dl>
<pre class="fragment">e2a71ch-flw: ECC_Sign(ident=16, idx=0; dgstLen=64)
e2a71ch-flw: A71_EccNormalizedAsnSign called successfully: sigDERLen=72
e2a71ch-flw: EmbSe_ECDSA_Do_Sign success.
&gt;&gt;&gt; ??? [length 0005]
    16 03 03 00 50
&gt;&gt;&gt; TLS 1.2 Handshake [length 0050], CertificateVerify
    0f 00 00 4c 06 03 00 48 30 46 02 21 00 bf ac ce
    eb e5 7a e1 f1 3d 3b 06 60 1d 4b a3 56 74 db 01
    66 20 1c 4a c2 f5 ef 7a ba e2 18 04 81 02 21 00
    f5 d4 09 6c 2b a9 bb f8 ea f9 91 0a 42 c6 6e 17
    80 f1 de 2d 4c e8 81 90 c4 c8 02 9e ac d5 ca ff
SSL_connect:SSLv3 write certificate verify A
</pre><h2><a class="anchor" id="autotoc_md33"></a>
(2.9) ChangeCipherSpec (Client-&gt;Server)</h2>
<pre class="fragment">&gt;&gt;&gt; ??? [length 0005]
    14 03 03 00 01
&gt;&gt;&gt; TLS 1.2 ChangeCipherSpec [length 0001]
    01
SSL_connect:SSLv3 write change cipher spec A
</pre><h2><a class="anchor" id="autotoc_md34"></a>
(2.10) Finished (Client-&gt;Server)</h2>
<pre class="fragment">e2a71ch-flw: EmbSe_Rand invoked requesting 16 random bytes
&gt;&gt;&gt; ??? [length 0005]
    16 03 03 00 40
&gt;&gt;&gt; TLS 1.2 Handshake [length 0010], Finished
    14 00 00 0c a6 d1 5c f4 8b f3 f5 f2 c5 40 02 88
SSL_connect:SSLv3 write finished A
SSL_connect:SSLv3 flush data
</pre><h2><a class="anchor" id="autotoc_md35"></a>
(2.11) ?? Handshake ?? (Server-&gt;Client)</h2>
<pre class="fragment">&lt;&lt;&lt; ??? [length 0005]
    16 03 03 02 7a
&lt;&lt;&lt; TLS 1.2 Handshake [length 027a]???
    04 00 02 76 00 00 01 2c 02 70 64 aa a4 29 19 1b
    cd f2 74 d4 8b 39 9f d3 58 af 18 f8 44 11 27 b5
    f5 22 77 75 4c b1 d1 66 5d 78 6b 5d 12 b8 e2 c2
    ec c5 a2 09 72 9a 30 0f 5e ac 8d 66 33 ac db 34
    a6 7e c2 9c 8d 93 f1 2a b6 1a ac bd a1 49 7f c5
    5c 43 9f 33 e9 f1 b3 6c 67 73 92 1b 02 30 ed 2e
    dc 38 43 39 70 99 79 5e 3a b4 69 13 7d 65 aa 1f
    43 93 e1 59 ca 3e ec 7b 80 b0 a3 cd 26 cc 66 9e
    f5 1f 29 47 7a 5a 0e bb eb f9 5a f9 bd 23 cb ca
    50 3e 73 10 6e 6c 67 60 77 ca aa b5 ca 36 2d 2f
    97 c3 91 68 03 ce 98 11 72 98 b8 81 48 3d e5 df
    9d ce 0b bb 9b 44 db 08 d6 a1 65 98 d3 6f ef 57
    c5 2f cf b5 27 f5 8c 19 eb b6 7b 09 f3 2e 6e 5e
    f8 99 07 f3 82 ec 6b 6e 4e 0b 18 ef 3f 6e 0d eb
    42 bd cd 7b e1 60 e5 a9 de 80 fc 68 17 46 99 63
    e8 c2 6f bc 32 29 25 31 a5 b1 0a 10 a2 57 5c 34
    f9 89 2f a3 9e a6 55 a8 72 c1 3d 62 07 a3 32 39
    f5 de e3 09 9e 2d 17 8d 5e 1a 1b 55 79 8c cd ab
    e0 b4 2d 9a 5d 6b 78 0d 5e 1c 42 f3 5b c5 55 c9
    9b 3f 1f c4 49 42 28 99 5c f0 50 10 c6 c4 13 08
    17 69 a4 d1 d2 00 a9 80 f3 55 bd 66 a3 a1 a3 46
    50 df 6b b2 44 7a 20 98 35 14 c7 4b 75 61 ca 54
    05 b5 6b 25 9c 83 2f 42 59 02 54 ab 07 84 2f 3a
    a9 b1 12 98 12 0d 85 39 b0 fd f6 42 28 d8 32 2d
    8a f8 97 a8 02 22 4d bb ef b9 90 08 d3 59 e7 06
    e8 dc e6 b9 6f 3f 64 32 ca bc 21 c5 b1 f1 55 e6
    0a e6 b1 c1 98 fe d1 c6 35 db 87 5a 47 9b 64 2a
    b4 43 c1 8c 0d 65 4e 9b 38 bc 62 35 7c b8 a9 3e
    6d 00 23 88 e5 57 00 44 d4 20 c4 ea db 09 fa 21
    8e 44 68 66 72 b7 43 a4 e3 ab 46 4a f4 3d 89 c7
    c7 c6 62 cd 1f 5d 8f e3 83 79 2d 7a cb c9 9c a9
    a0 6c 4e cd 04 0d 4a 5b 52 06 6f 61 2f 90 02 9c
    40 67 8b d9 e8 1c c5 7d f8 c0 77 2f 32 f9 90 75
    b5 df 32 f9 95 06 da cd 94 52 1e d7 08 8b a6 48
    e6 ea d0 e8 d4 f7 e0 39 e6 d6 06 13 a1 5c 56 60
    c0 63 2c f2 aa f7 d8 08 83 d8 b2 1c 67 de d2 73
    9c 2d 19 12 fd a6 ff c9 2d a2 62 aa f9 94 cb 1e
    00 e8 67 0c 51 a9 5e 5c 4c 9e 03 e1 3f 5d 46 c5
    d9 e8 08 02 f1 e4 93 42 58 87 a5 b8 c7 38 7f f2
    40 15 d9 b7 2b 2c ce f6 9e 06
SSL_connect:SSLv3 read server session ticket A
</pre><h2><a class="anchor" id="autotoc_md36"></a>
(2.12) ChangeCipherSpec (Server-&gt;Client)</h2>
<pre class="fragment">&lt;&lt;&lt; ??? [length 0005]
    14 03 03 00 01
&lt;&lt;&lt; TLS 1.2 ChangeCipherSpec [length 0001]
    01
</pre><h2><a class="anchor" id="autotoc_md37"></a>
(2.13) Finished (Server-&gt;Client)</h2>
<pre class="fragment">&lt;&lt;&lt; ??? [length 0005]
    16 03 03 00 40
&lt;&lt;&lt; TLS 1.2 Handshake [length 0010], Finished
    14 00 00 0c 3f a3 65 6b f0 78 a3 04 17 8f a5 a2
SSL_connect:SSLv3 read finished A
</pre><h1><a class="anchor" id="autotoc_md38"></a>
(3) Miscelaneous</h1>
<pre class="fragment">Certificate chain
 0 s:/C=BE/O=NXPDemo/OU=Unit/CN=ECC-demo-server
   i:/C=BE/ST=VlaamsBrabant/L=Leuven/O=NXP-Demo-CA/OU=Demo-Unit/CN=demoCA/emailAddress=demoCA@nxp
 1 s:/C=BE/ST=VlaamsBrabant/L=Leuven/O=NXP-Demo-CA/OU=Demo-Unit/CN=demoCA/emailAddress=demoCA@nxp
   i:/C=BE/ST=VlaamsBrabant/L=Leuven/O=NXP-Demo-CA/OU=Demo-Unit/CN=demoCA/emailAddress=demoCA@nxp

Server certificate
-----BEGIN CERTIFICATE-----
MIIBxDCCAWsCCQDFSEDajfYvnTAKBggqhkjOPQQDAjCBjDELMAkGA1UEBhMCQkUx
FjAUBgNVBAgMDVZsYWFtc0JyYWJhbnQxDzANBgNVBAcMBkxldXZlbjEUMBIGA1UE
CgwLTlhQLURlbW8tQ0ExEjAQBgNVBAsMCURlbW8tVW5pdDEPMA0GA1UEAwwGZGVt
b0NBMRkwFwYJKoZIhvcNAQkBFgpkZW1vQ0FAbnhwMB4XDTE3MDYwODEyNTAyM1oX
DTI1MDIwNjEyNTAyM1owSDELMAkGA1UEBhMCQkUxEDAOBgNVBAoMB05YUERlbW8x
DTALBgNVBAsMBFVuaXQxGDAWBgNVBAMMD0VDQy1kZW1vLXNlcnZlcjBZMBMGByqG
SM49AgEGCCqGSM49AwEHA0IABJalK+mIWAjL+7nONyUFdxtqDaduD7M4ujRubdRx
bHeBaZQpBEZbkVHZVv9F5VyyFpPlo+c3ls0A9YviHSZIozgwCgYIKoZIzj0EAwID
RwAwRAIgZTm7Tdjm1WheN6BZQ0gfelNk/X+C5v2kZRi9oaBrzV4CIFVsKe3RuyqP
jOBu9AU9hQQw5GM6UxxZvMh+HmSazkOr
-----END CERTIFICATE-----
subject=/C=BE/O=NXPDemo/OU=Unit/CN=ECC-demo-server
issuer=/C=BE/ST=VlaamsBrabant/L=Leuven/O=NXP-Demo-CA/OU=Demo-Unit/CN=demoCA/emailAddress=demoCA@nxp

Acceptable client certificate CA names
/C=BE/ST=VlaamsBrabant/L=Leuven/O=NXP-Demo-CA/OU=Demo-Unit/CN=demoCA/emailAddress=demoCA@nxp
Client Certificate Types: RSA sign, DSA sign, RSA fixed ECDH, ECDSA fixed ECDH, ECDSA sign
Requested Signature Algorithms: RSA+SHA512:DSA+SHA512:ECDSA+SHA512:RSA+SHA384:DSA+SHA384:ECDSA+SHA384:RSA+SHA256:DSA+SHA256:ECDSA+SHA256:RSA+SHA224:DSA+SHA224:ECDSA+SHA224:RSA+SHA1:DSA+SHA1:ECDSA+SHA1
Shared Requested Signature Algorithms: RSA+SHA512:DSA+SHA512:ECDSA+SHA512:RSA+SHA384:DSA+SHA384:ECDSA+SHA384:RSA+SHA256:DSA+SHA256:ECDSA+SHA256:RSA+SHA224:DSA+SHA224:ECDSA+SHA224:RSA+SHA1:DSA+SHA1:ECDSA+SHA1

SSL handshake has read 2070 bytes and written 1464 bytes

New, TLSv1/SSLv3, Cipher is ECDH-ECDSA-AES128-SHA
Server public key is 256 bit
Secure Renegotiation IS supported
Compression: zlib compression
Expansion: zlib compression
No ALPN negotiated
SSL-Session:
    Protocol  : TLSv1.2
    Cipher    : ECDH-ECDSA-AES128-SHA
    Session-ID: 38AE5AA093AE4752873598BDBF22E7E10559D818275DB0BA85627334C5240EC8
    Session-ID-ctx:
    Master-Key: 6D674DB4AAE0F4D5FF79DE919D70A722B776241434AA6BEC08A279B40DB958F2D2FB1D2F2D4A15CE3D615A3D835DF2C6
    Key-Arg   : None
    PSK identity: None
    PSK identity hint: None
    SRP username: None
    TLS session ticket lifetime hint: 300 (seconds)
    TLS session ticket:
    0000 - 64 aa a4 29 19 1b cd f2-74 d4 8b 39 9f d3 58 af   d..)....t..9..X.
    0010 - 18 f8 44 11 27 b5 f5 22-77 75 4c b1 d1 66 5d 78   ..D.'.."wuL..f]x
    0020 - 6b 5d 12 b8 e2 c2 ec c5-a2 09 72 9a 30 0f 5e ac   k]........r.0.^.
    0030 - 8d 66 33 ac db 34 a6 7e-c2 9c 8d 93 f1 2a b6 1a   .f3..4.~.....*..
    0040 - ac bd a1 49 7f c5 5c 43-9f 33 e9 f1 b3 6c 67 73   ...I..\C.3...lgs
    0050 - 92 1b 02 30 ed 2e dc 38-43 39 70 99 79 5e 3a b4   ...0...8C9p.y^:.
    0060 - 69 13 7d 65 aa 1f 43 93-e1 59 ca 3e ec 7b 80 b0   i.}e..C..Y.&gt;.{..
    0070 - a3 cd 26 cc 66 9e f5 1f-29 47 7a 5a 0e bb eb f9   ..&amp;.f...)GzZ....
    0080 - 5a f9 bd 23 cb ca 50 3e-73 10 6e 6c 67 60 77 ca   Z..#..P&gt;s.nlg`w.
    0090 - aa b5 ca 36 2d 2f 97 c3-91 68 03 ce 98 11 72 98   ...6-/...h....r.
    00a0 - b8 81 48 3d e5 df 9d ce-0b bb 9b 44 db 08 d6 a1   ..H=.......D....
    00b0 - 65 98 d3 6f ef 57 c5 2f-cf b5 27 f5 8c 19 eb b6   e..o.W./..'.....
    00c0 - 7b 09 f3 2e 6e 5e f8 99-07 f3 82 ec 6b 6e 4e 0b   {...n^......knN.
    00d0 - 18 ef 3f 6e 0d eb 42 bd-cd 7b e1 60 e5 a9 de 80   ..?n..B..{.`....
    00e0 - fc 68 17 46 99 63 e8 c2-6f bc 32 29 25 31 a5 b1   .h.F.c..o.2)%1..
    00f0 - 0a 10 a2 57 5c 34 f9 89-2f a3 9e a6 55 a8 72 c1   ...W\4../...U.r.
    0100 - 3d 62 07 a3 32 39 f5 de-e3 09 9e 2d 17 8d 5e 1a   =b..29.....-..^.
    0110 - 1b 55 79 8c cd ab e0 b4-2d 9a 5d 6b 78 0d 5e 1c   .Uy.....-.]kx.^.
    0120 - 42 f3 5b c5 55 c9 9b 3f-1f c4 49 42 28 99 5c f0   B.[.U..?..IB(.\.
    0130 - 50 10 c6 c4 13 08 17 69-a4 d1 d2 00 a9 80 f3 55   P......i.......U
    0140 - bd 66 a3 a1 a3 46 50 df-6b b2 44 7a 20 98 35 14   .f...FP.k.Dz .5.
    0150 - c7 4b 75 61 ca 54 05 b5-6b 25 9c 83 2f 42 59 02   .Kua.T..k%../BY.
    0160 - 54 ab 07 84 2f 3a a9 b1-12 98 12 0d 85 39 b0 fd   T.../:.......9..
    0170 - f6 42 28 d8 32 2d 8a f8-97 a8 02 22 4d bb ef b9   .B(.2-....."M...
    0180 - 90 08 d3 59 e7 06 e8 dc-e6 b9 6f 3f 64 32 ca bc   ...Y......o?d2..
    0190 - 21 c5 b1 f1 55 e6 0a e6-b1 c1 98 fe d1 c6 35 db   !...U.........5.
    01a0 - 87 5a 47 9b 64 2a b4 43-c1 8c 0d 65 4e 9b 38 bc   .ZG.d*.C...eN.8.
    01b0 - 62 35 7c b8 a9 3e 6d 00-23 88 e5 57 00 44 d4 20   b5|..&gt;m.#..W.D.
    01c0 - c4 ea db 09 fa 21 8e 44-68 66 72 b7 43 a4 e3 ab   .....!.Dhfr.C...
    01d0 - 46 4a f4 3d 89 c7 c7 c6-62 cd 1f 5d 8f e3 83 79   FJ.=....b..]...y
    01e0 - 2d 7a cb c9 9c a9 a0 6c-4e cd 04 0d 4a 5b 52 06   -z.....lN...J[R.
    01f0 - 6f 61 2f 90 02 9c 40 67-8b d9 e8 1c c5 7d f8 c0   oa/...@g.....}..
    0200 - 77 2f 32 f9 90 75 b5 df-32 f9 95 06 da cd 94 52   w/2..u..2......R
    0210 - 1e d7 08 8b a6 48 e6 ea-d0 e8 d4 f7 e0 39 e6 d6   .....H.......9..
    0220 - 06 13 a1 5c 56 60 c0 63-2c f2 aa f7 d8 08 83 d8   ...\V`.c,.......
    0230 - b2 1c 67 de d2 73 9c 2d-19 12 fd a6 ff c9 2d a2   ..g..s.-......-.
    0240 - 62 aa f9 94 cb 1e 00 e8-67 0c 51 a9 5e 5c 4c 9e   b.......g.Q.^\L.
    0250 - 03 e1 3f 5d 46 c5 d9 e8-08 02 f1 e4 93 42 58 87   ..?]F........BX.
    0260 - a5 b8 c7 38 7f f2 40 15-d9 b7 2b 2c ce f6 9e 06   ...8..@...+,....

    Compression: 1 (zlib compression)
    Start Time: 1497266951
    Timeout   : 7200 (sec)
    Verify return code: 0 (ok)</pre> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="gax_openssl_engine.html">OpenSSL Engine</a></li>
    <li class="footer">Generated on Fri Sep 7 2018 19:24:07 for A71CH Host Sw by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
