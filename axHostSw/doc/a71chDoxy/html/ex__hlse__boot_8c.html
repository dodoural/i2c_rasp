<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>A71CH Host Sw: C:/ubuntu_exchange/axHostSw/hostLib/a71ch/ex_hlse/ex_hlse_boot.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">A71CH Host Sw
   &#160;<span id="projectnumber">v01.05.00</span>
   </div>
   <div id="projectbrief">NXP Semiconductors</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('ex__hlse__boot_8c.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">ex_hlse_boot.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;assert.h&gt;</code><br />
<code>#include &quot;<a class="el" href="a71ch__ex__hlse_8h_source.html">a71ch_ex_hlse.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="a71__debug_8h_source.html">a71_debug.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="sm__types_8h_source.html">sm_types.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="sm__apdu_8h_source.html">sm_apdu.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="tst__sm__util_8h_source.html">tst_sm_util.h</a>&quot;</code><br />
<code>#include &quot;sm_printf.h&quot;</code><br />
<code>#include &quot;<a class="el" href="ax_host_crypto_8h_source.html">axHostCrypto.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="tst_host_crypto_8h_source.html">tstHostCrypto.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="scp_8h_source.html">scp.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="ax__util_8h_source.html">ax_util.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="tst__a71ch__util_8h_source.html">tst_a71ch_util.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="tst__hlse__a71ch__util_8h_source.html">tst_hlse_a71ch_util.h</a>&quot;</code><br />
</div>
<p><a href="ex__hlse__boot_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a3de4b8f25fd52dec34b28612fd7725af"><td class="memItemLeft" align="right" valign="top">U8&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ex__hlse__boot_8c.html#a3de4b8f25fd52dec34b28612fd7725af">exHlseBoot</a> (U8 bootMode)</td></tr>
<tr class="separator:a3de4b8f25fd52dec34b28612fd7725af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0457d9db642ddac592e236afa0dfaf9"><td class="memItemLeft" align="right" valign="top">U8&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ex__hlse__boot_8c.html#ac0457d9db642ddac592e236afa0dfaf9">axExHlseCreateAndSetInitialHostScpKeys</a> (U8 *keyEnc, U8 *keyMac, U8 *keyDek)</td></tr>
<tr class="separator:ac0457d9db642ddac592e236afa0dfaf9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a56af183e7144b51dbbec01b5c82dda90"><td class="memItemLeft" align="right" valign="top">U8&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ex__hlse__boot_8c.html#a56af183e7144b51dbbec01b5c82dda90">axExHlseAuthenticate</a> (U8 *keyEnc, U8 *keyMac, U8 *keyDek)</td></tr>
<tr class="separator:a56af183e7144b51dbbec01b5c82dda90"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>NXP Semiconductors </dd></dl>
<dl class="section version"><dt>Version</dt><dd>1.0 </dd></dl>
<dl class="section user"><dt>License</dt><dd>Copyright 2016 NXP</dd></dl>
<p>This software is owned or controlled by NXP and may only be used strictly in accordance with the applicable license terms. By expressly accepting such terms or by downloading, installing, activating and/or otherwise using the software, you are agreeing that you have read, and that you agree to comply with and are bound by, such license terms. If you do not agree to be bound by the applicable license terms, then you may not retain, install, activate or otherwise use the software.</p>
<dl class="section user"><dt>Description</dt><dd>Handover of SCP03 session keys from bootloader to OS. Refer to <a class="el" href="ex__hlse__boot_8c.html#a3de4b8f25fd52dec34b28612fd7725af">exHlseBoot</a> for more details. </dd></dl>

<p class="definition">Definition in file <a class="el" href="ex__hlse__boot_8c_source.html">ex_hlse_boot.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a56af183e7144b51dbbec01b5c82dda90"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a56af183e7144b51dbbec01b5c82dda90">&#9670;&nbsp;</a></span>axExHlseAuthenticate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">U8 axExHlseAuthenticate </td>
          <td>(</td>
          <td class="paramtype">U8 *&#160;</td>
          <td class="paramname"><em>keyEnc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">U8 *&#160;</td>
          <td class="paramname"><em>keyMac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">U8 *&#160;</td>
          <td class="paramname"><em>keyDek</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The host locally stores the SCP03 base keys passed as parameters and establishes the authenticated and encrypted SCP03 channel with the A71CH.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">keyEnc</td><td>IN: SCP03 base key </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">keyMac</td><td>IN: SCP03 base key </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">keyDek</td><td>IN: SCP03 base key </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ex__hlse__boot_8c_source.html#l00411">411</a> of file <a class="el" href="ex__hlse__boot_8c_source.html">ex_hlse_boot.c</a>.</p>

</div>
</div>
<a id="ac0457d9db642ddac592e236afa0dfaf9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0457d9db642ddac592e236afa0dfaf9">&#9670;&nbsp;</a></span>axExHlseCreateAndSetInitialHostScpKeys()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">U8 axExHlseCreateAndSetInitialHostScpKeys </td>
          <td>(</td>
          <td class="paramtype">U8 *&#160;</td>
          <td class="paramname"><em>keyEnc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">U8 *&#160;</td>
          <td class="paramname"><em>keyMac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">U8 *&#160;</td>
          <td class="paramname"><em>keyDek</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The host fetches random data from the A71CH and sets these as SCP03 base keys in the A71CH.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">keyEnc</td><td>IN: Buffer to contain key; OUT: Key created and inserted into A71CH </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">keyMac</td><td>IN: Buffer to contain key; OUT: Key created and inserted into A71CH </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">keyDek</td><td>IN: Buffer to contain key; OUT: Key created and inserted into A71CH </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ex__hlse__boot_8c_source.html#l00359">359</a> of file <a class="el" href="ex__hlse__boot_8c_source.html">ex_hlse_boot.c</a>.</p>

</div>
</div>
<a id="a3de4b8f25fd52dec34b28612fd7725af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3de4b8f25fd52dec34b28612fd7725af">&#9670;&nbsp;</a></span>exHlseBoot()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">U8 exHlseBoot </td>
          <td>(</td>
          <td class="paramtype">U8&#160;</td>
          <td class="paramname"><em>bootMode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This example illustrates that the HostOS does NOT need to know the SCP03 Base Keys to establish an SCP03 session (provided the boot loader has established the SCP03 session and saved the SCP03 session state)</p>
<p>When using SCI2C the bootloader must also save the SCI2C state.</p>
<ul>
<li>The boot loader<ul>
<li>Sets an initial SCP03 base key set (based on random data retrieved from the SM (Secure Module))</li>
<li>Establishes an SCP03 session</li>
<li>Stores the SCP03 session (optionally also SCI2C state)</li>
</ul>
</li>
<li>The OS<ul>
<li>Retrieves the SCP03 session and communication state</li>
<li>Resumes the SCP03 session</li>
</ul>
</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>When the OS takes over from the boot loader the communication link with the Secure Element may not be broken. </dd>
<dd>
Storing the session and communication state on the filesystem is done for convenience in this example. Use an appropriate and secure sharing mechanism in a product implementation. </dd>
<dd>
Full functionality of this example is only available when connecting to the A71CH over SCI2C. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">bootMode</td><td>One of the following values<ul>
<li><a class="el" href="a71ch__ex__hlse_8h.html#a10161526e79dcccebcd449cc6c8efed3" title="Argument relevant to exBoot. ">BOOT_SIMULATED_CYCLE</a> Can be used to simulate handover of session keys (no dependency on link protocol)</li>
<li><a class="el" href="a71ch__ex__hlse_8h.html#a2cc483b438800856cb92a06df111009e" title="Argument relevant to exBoot. ">BOOT_BOOTLOADER_ROLE</a> Play the role of initial bootloader and store session and communication state to filesystem</li>
<li><a class="el" href="a71ch__ex__hlse_8h.html#a8272c91f46f5495eb58a17afb1cc2d8b" title="Argument relevant to exBoot. ">BOOT_HOST_OS_RESUME</a> Play the role of OS and retrieve session and communication state from the filesystem </li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ex__hlse__boot_8c_source.html#l00126">126</a> of file <a class="el" href="ex__hlse__boot_8c_source.html">ex_hlse_boot.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_334bf0e2cc3331174eefb01118a0a83d.html">hostLib</a></li><li class="navelem"><a class="el" href="dir_ceffb261bb5d756d1931d3d27f14ec57.html">a71ch</a></li><li class="navelem"><a class="el" href="dir_e94cd5e3ba4be26f16cb3bf8eb907b85.html">ex_hlse</a></li><li class="navelem"><a class="el" href="ex__hlse__boot_8c.html">ex_hlse_boot.c</a></li>
    <li class="footer">Generated on Fri Sep 7 2018 19:24:07 for A71CH Host Sw by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
