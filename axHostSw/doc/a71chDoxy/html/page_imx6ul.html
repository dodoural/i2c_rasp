<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>A71CH Host Sw: Setup i.MX6ULEVK</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">A71CH Host Sw
   &#160;<span id="projectnumber">v01.05.00</span>
   </div>
   <div id="projectbrief">NXP Semiconductors</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('page_imx6ul.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Setup i.MX6ULEVK </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li>DocRevision : 0.97</li>
<li>Date : 2018-04-04</li>
</ul>
<p>This section explains how to set-up a cross-compilation environment for the i.MX6UL and how to connect the MCIMX6UL-EVKB board to an A71CH on an I2C mini-PCB.</p>
<dl class="section note"><dt>Note</dt><dd>The MCIMX6UL-EVKB board is NXP's current evaluation board for the i.MX6UL. For the purpose of evaluating the A71CH also the previous version of the board can be used (MCIMX6UL-EVK)</dd></dl>
<h1><a class="anchor" id="autotoc_md68"></a>
Preparation Steps</h1>
<h2><a class="anchor" id="autotoc_md69"></a>
(1) Downloading and Installing Yocto for i.MX6UL (MCIMX6UL-EVK board)</h2>
<p>Please consult first the detailed information that can be found on (<code><a href="http://www.nxp.com/imx6ULEVK">http://www.nxp.com/imx6ULEVK</a></code>). Download e.g. the L4.9.11_1.0.0_LINUX_DOCS documentation package (available on <code><a href="https://www.nxp.com/products/processors-and-microcontrollers/applications-processors/i.mx-applications-processors/i.mx-6-processors/i.mx6ultralite-evaluation-kit:MCIMX6UL-EVK?tab=Documentation_Tab">https://www.nxp.com/products/processors-and-microcontrollers/applications-processors/i.mx-applications-processors/i.mx-6-processors/i.mx6ultralite-evaluation-kit:MCIMX6UL-EVK?tab=Documentation_Tab</a></code> under the header 'Supporting Information') and take the ‘i.MX Yocto Project User’s Guide’ as a starting point.</p>
<p>Yocto must be installed on a Linux PC (consult the documentation for the Linux distributions officially supported), it’s possible to use a Virtual PC environment as e.g. Virtual Box. The Linux PC must have access to the internet to retrieve additional packages, tools and sources.</p>
<p>Having set-up all tools and packages required by Yocto, initialize a local git repository as follows: </p><pre class="fragment">&gt; mkdir ~/projects/fsl-arm-yocto-bsp
&gt; cd ~/projects/fsl-arm-yocto-bsp
&gt; repo init -u git://git.freescale.com/imx/fsl-arm-yocto-bsp.git -b imx-morty -m imx-4.9.11-1.0.0_ga.xml
&gt; repo sync
</pre><h2><a class="anchor" id="autotoc_md70"></a>
(2) Prepare an embedded linux distribution for the MCIMX6UL-EVK board</h2>
<p>The bitbake target <code>core-image-full-cmdline</code> created for MCIMX6UL-EVK contains a busybox implementation of the usual Unix command line tools. It assumes you will interact with the embedded system over the command line. </p><pre class="fragment">&gt; cd ~/projects/fsl-arm-yocto-bsp
&gt; DISTRO=fsl-imx-fb MACHINE=imx6ulevk source fsl-setup-release.sh -b build-fb-6ul
</pre><p>Now, before issuing the bitbake command, first edit the file <code>build-fb-6ul/conf/local.conf</code> so it matches the following: </p><pre class="fragment">MACHINE ??= 'imx6ulevk'
DISTRO ?= 'fsl-imx-fb'
PACKAGE_CLASSES ?= "package_rpm"
EXTRA_IMAGE_FEATURES ?= "debug-tweaks tools-debug tools-testapps package-management"
USER_CLASSES ?= "buildstats image-mklibs image-prelink"
PATCHRESOLVE = "noop"
BB_DISKMON_DIRS = "\
    STOPTASKS,${TMPDIR},1G,100K \
    STOPTASKS,${DL_DIR},1G,100K \
    STOPTASKS,${SSTATE_DIR},1G,100K \
    STOPTASKS,/tmp,100M,100K \
    ABORT,${TMPDIR},100M,1K \
    ABORT,${DL_DIR},100M,1K \
    ABORT,${SSTATE_DIR},100M,1K \
    ABORT,/tmp,10M,1K"
PACKAGECONFIG_append_pn-qemu-native = " sdl"
PACKAGECONFIG_append_pn-nativesdk-qemu = " sdl"
CONF_VERSION = "1"
IMAGE_ROOTFS_EXTRA_SPACE = "320000"

DL_DIR ?= "${BSPDIR}/downloads/"
ACCEPT_FSL_EULA = "1"

IMAGE_INSTALL_append += " cmake curl git subversion"
</pre><dl class="section note"><dt>Note</dt><dd>If you would rather prepare an embedded linux distribution with native development tools, use the local.conf file provided in the appendix (at the bottom of this page)</dd></dl>
<p>After updating the file <code>build-fb-6ul/conf/local.conf</code> issue the following command: </p><pre class="fragment">&gt; bitbake core-image-full-cmdline
</pre><dl class="section note"><dt>Note</dt><dd>The directory <code>build-fb-6ul</code> will contain downloaded sources and build artefacts.</dd></dl>
<p>When the above bitbake command finished successfully an sdcard image containing bootloader, filesystem and linux kernel is available under <code>~/projects/fsl-arm-yocto-bsp/build-fb-6ul/tmp/deploy/images/imx6ulevk/core-image-full-cmdline-imx6ulevk</code>.sdcard. 'core-image-full-cmdline-imx6ulevk.sdcard' is a symbolic link to the actual file name - which has a timestamp as part of the filename e.g. 'core-image-full-cmdline-imx6ulevk-20170825222257.rootfs.sdcard'. Copy this sdcard image to a microSD card either with the method described in the ‘i.MX Yocto Project User’s Guide’ or on a Windows PC with e.g. the Win32DiskImager tool.</p>
<dl class="section note"><dt>Note</dt><dd>The embedded linux system prepared has a user 'root' that does not require a password.</dd></dl>
<p>Now one needs to apply (only once) a workaround for a problem described in the release notes of Yocto-Linux imx-4.9.11-1.0.0 (Cf. Release Notes: Table 12. Common known issues and workarounds for i.MX 6 and i.MX 7 - Network connection over Ethernet is not established automatically). Hook up a terminal to the IMX6UL-EVK board over the USB-Serial link, log on and issue the following commands: </p><pre class="fragment">systemctl unmask connman
systemctl enable connman
systemctl start connman
</pre><dl class="section note"><dt>Note</dt><dd>Check the appendix at the bottom of this page for an alternative image that includes a native compiler and SDK.</dd></dl>
<h2><a class="anchor" id="autotoc_md71"></a>
(3) Create and install SDK and Root file system on Host</h2>
<pre class="fragment">&gt; cd ~/projects/fsl-arm-yocto-bsp
&gt; MACHINE=imx6ulevk source setup-environment build-fb-6ul
&gt; bitbake -c populate_sdk core-image-full-cmdline
</pre><p>To install the SDK in the default location /opt/fsl-imx-fb/4.9.11-1.0.0 </p><pre class="fragment">&gt; cd ~/projects/fsl-arm-yocto-bsp/build-fb-6ul/tmp/deploy/sdk/
&gt; ./fsl-imx-fb-glibc-x86_64-core-image-full-cmdline-cortexa7hf-neon-toolchain-4.9.11-1.0.0.sh
</pre><p>You have now installed a set of cross-compilation tools for the MCIMX6UL-EVK board on the Linux Host PC.</p>
<h2><a class="anchor" id="autotoc_md72"></a>
(4) Unpacking the A71CH SW package</h2>
<pre class="fragment">&gt; cd
&gt; ls
    ...  projects  ...
</pre><p>Create a directory 'axHostSw' in the 'projects' directory </p><pre class="fragment">&gt; cd projects
&gt; mkdir axHostSw
&gt; cd axHostSw
</pre><p>Retrieve the package A71CH_HostSolution_1.3_src.tgz and unpack it in the axHostSw directory </p><pre class="fragment">&gt; cd axHostSw
&gt; tar xzvf A71CH_HostSolution_1.3_src.tgz
&gt; ls
    A71CH_HostSolution_1.3_src.tgz doc hostLib linux win32
</pre><dl class="section note"><dt>Note</dt><dd>You may be installing a different/later version of the A71CH SW package</dd></dl>
<h2><a class="anchor" id="autotoc_md73"></a>
(5) Cross-compile</h2>
<p>Start by setting up the appropriate environment variables for the cross compiler. </p><pre class="fragment">&gt; cd ~/projects/axHostSw/linux
&gt; source /opt/fsl-imx-fb/4.9.11-1.0.0/environment-setup-cortexa7hf-neon-poky-linux-gnueabi
</pre><p>Build the individual targets. </p><pre class="fragment">&gt; make -f Makefile_A71CH default app=A71CH conn=i2c platf=imx
</pre><p>The following executable is created: </p><pre class="fragment">A71CH_i2c_imx
</pre><h2><a class="anchor" id="autotoc_md74"></a>
(6) Transfer cross-compiled application to embedded system</h2>
<p>As we created the application <code>A71CH_i2c_imx</code> on the host PC, it still needs to be transferred to the filesystem of the embedded platform. One can transfer the file via scp, ftp or use a USB stick.</p>
<p>The following transcript illustrates using scp to transfer the file from the Development PC to the embedded platform </p><pre class="fragment">&gt; scp A71CH_i2c_imx root@192.168.1.65:/home/root
</pre><p>The following transcript illustrates using a USB stick (containing the exe) to transfer the file. </p><pre class="fragment">imx&gt; cd /home/root
imx&gt; mount /dev/sda1 usb # usb is mount point (directory) available in /home/root
imx&gt; cp usb/A71CH_i2c_imx  .
..
imx&gt; umount usb
</pre><h2><a class="anchor" id="autotoc_md75"></a>
(7) Try out the A71CH_i2c_imx Application</h2>
<p>This app is built on top of the Host API.</p>
<p>Ensure the A71CH-mini-PCB is connected as follows to the MCIMX6UL-EVK boards. The pins required to connect the A71CH over I2C are available on connector J1704 (part of Arduino Header) of the MCIMX6UL-EVK board:</p><ul>
<li>Pin 7: GND</li>
<li>Pin 8: VPERI_3V3</li>
<li>Pin 9: I2C2_SDA</li>
<li>Pin 10: I2C2_SCL</li>
</ul>
<p>The relevant pins of the connector (Pin 10 is located at the outside of the connector: the top pin inside the red circle) are highlighted on the following figure: </p><div class="image">
<img src="iMX6UltraLite_Circle.png" alt="iMX6UltraLite_Circle.png"/>
<div class="caption">
Connecting to MCIMX6UL-EVK board</div></div>
<p> The following drawing illustrates the pins to connect (using the Arduino shield pin naming conventions): </p><div class="image">
<object type="image/svg+xml" data="ArduinoConnectorImx6ulevkb.svg">ArduinoConnectorImx6ulevkb.svg</object>
<div class="caption">
I2C pins on MCIMX6UL-EVK board's Arduino-Shield compatible connector </div></div>
<p> Go to the location in the embedded filesystem where the cross-compiled application was stored and start the application: </p><pre class="fragment">imx&gt; cd 'location on embedded platform'
imx&gt; ./A71CH_i2c_imx
</pre><p>A sample of the output (stdout in the console) created by the application: </p><pre class="fragment">a71ch HostLibrary example application (Rev 1.20:1.21)
**********************************************
Connect to A71CH-SM. Chunksize at link layer = 256.
I2CInit: opening /dev/i2c-1
I2C driver: PEC flag cleared
I2C driver supports plain i2c-level commands.
I2C driver supports Read Block.
SCI2C_ATR=0xB8.04.11.01.05.04.B9.02.01.01.BA.01.01.BB.0D.41.37.31.30.31.43.48.20.32.34.32.52.31.BC.00.
HostLib Version  : 0x0110
Applet Version   : 0x0121
SecureBox Version: 0x0000

==========SELECT-DONE=========

-----------
Start exAes()
------------

-----------
Start exAesRfc3394Precooked(Reset)
------------
...
</pre><h2><a class="anchor" id="autotoc_md76"></a>
(Appendix) Prepare an embedded linux distribution for the MCIMX6UL-EVK board with native compiler and SDK</h2>
<p>The approach is identical to the one described in section (2) of this document, please use the following local.conf file instead. Notice the two extra arguments provided to <code>EXTRA_IMAGE_FEATURES:</code> <code>dev-pkgs</code> and <code>tools-sdk</code>. </p><pre class="fragment">MACHINE ??= 'imx6ulevk'
DISTRO ?= 'fsl-imx-fb'
PACKAGE_CLASSES ?= "package_rpm"
EXTRA_IMAGE_FEATURES ?= "debug-tweaks dev-pkgs tools-debug tools-sdk tools-testapps package-management"
USER_CLASSES ?= "buildstats image-mklibs image-prelink"
PATCHRESOLVE = "noop"
BB_DISKMON_DIRS = "\
    STOPTASKS,${TMPDIR},1G,100K \
    STOPTASKS,${DL_DIR},1G,100K \
    STOPTASKS,${SSTATE_DIR},1G,100K \
    STOPTASKS,/tmp,100M,100K \
    ABORT,${TMPDIR},100M,1K \
    ABORT,${DL_DIR},100M,1K \
    ABORT,${SSTATE_DIR},100M,1K \
    ABORT,/tmp,10M,1K"
PACKAGECONFIG_append_pn-qemu-native = " sdl"
PACKAGECONFIG_append_pn-nativesdk-qemu = " sdl"
CONF_VERSION = "1"
IMAGE_ROOTFS_EXTRA_SPACE = "320000"

DL_DIR ?= "${BSPDIR}/downloads/"
ACCEPT_FSL_EULA = "1"

IMAGE_INSTALL_append += " cmake curl git subversion"
</pre><dl class="section note"><dt>Note</dt><dd>Creating a cross-compiler based on the above local.conf has not been tried. </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="page_platform.html">Platform</a></li>
    <li class="footer">Generated on Fri Sep 7 2018 19:24:07 for A71CH Host Sw by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
